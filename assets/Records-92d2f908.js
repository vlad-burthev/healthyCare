import{r as a,j as t,l as le}from"./index-8caec843.js";import{M as j,C as ie}from"./MyInput-fe4e4e82.js";import{E as he,a as f}from"./Main-5725fdca.js";import{u as M}from"./DelateBtn-49cae500.js";import{R as pe}from"./RecordItem-fab94c4d.js";const ue="_records_ab3xo_1",b={records:ue,"records-btn":"_records-btn_ab3xo_4"},c={"add-info__bg":"_add-info__bg_dpzuk_1","add-info__content":"_add-info__content_dpzuk_14","add-info__form":"_add-info__form_dpzuk_33","add-info__patient-name":"_add-info__patient-name_dpzuk_41","add-info__patient-list":"_add-info__patient-list_dpzuk_45","add-info__doctor-name":"_add-info__doctor-name_dpzuk_60","add-info__doctor-list":"_add-info__doctor-list_dpzuk_64","add-form__btn":"_add-form__btn_dpzuk_79"},fe=({addUser:m,setShowForm:_,records:d,api:p,setRecords:l})=>{const[S,I]=a.useState([]),[v,$]=a.useState([]),[N,w]=a.useState([]),{data:x}=M("http://localhost:3000/doctors");a.useEffect(()=>{x&&I(x)},[x]),a.useEffect(()=>{(async()=>{try{const s=await(await fetch("http://localhost:3000/patients")).json();$(s)}catch{}finally{}})()},[]),a.useEffect(()=>{(async()=>{try{const s=await(await fetch("http://localhost:3000/personal")).json();w(s)}catch{}finally{}})()},[]);const[n,r]=a.useState({personalId:"",personalName:"",patientDisease:"",patientId:"",doctorId:"",patientName:"",doctorName:"",patientPhone:"",doctorPhone:"",patientEmail:"",doctorEmail:"",patientAddress:"",doctorAddress:"",patientPhoto:"",doctorPhoto:"",doctorSpec:"",recordDate:"",recordTime:"",conclusion:"",id:Date.now()}),[u,R]=a.useState(!1),[D,q]=a.useState(),[y,J]=a.useState({});a.useEffect(()=>{(async()=>{try{const s=await(await fetch(`http://localhost:3000/patients/${D}`)).json();J(s)}catch{}finally{}})()},[D]);const[g,G]=a.useState(),[i,K]=a.useState({});a.useEffect(()=>{(async()=>{try{const s=await(await fetch(`http://localhost:3000/doctors/${g}`)).json();K(s)}catch{}finally{}})()},[g]);const[C,Q]=a.useState(),[W,X]=a.useState({});a.useEffect(()=>{(async()=>{try{const s=await(await fetch(`http://localhost:3000/personal/${C}`)).json();X(s)}catch{}finally{}})()},[g]);const Y=d.some(e=>e.recordDate===i.date&&e.recordTime===i.time?(console.log(!0),!0):!1),Z=()=>{const e={personalId:C,personalName:W.name,patinetId:D,patientName:y.name,doctorId:g,doctorName:i.name,patientPhone:y.phone,doctorPhone:i.phone,patientEmail:y.email,doctorEmail:i.email,patientAddress:y.address,doctorAddress:i.address,patientPhoto:y.photo,doctorPhoto:i.photo,patientDisease:y.disease,doctorSpec:i.disease,recordDate:n.date,recordTime:n.time,conclusion:"",id:Date.now()};if(Y===!1)if(n.patientName.length===0||n.doctorName.length===0)R(!0);else{fetch(`http://localhost:3000/${p}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(s=>s.json()).catch(s=>console.log(s)),l([...d,e]),_(!1);const o={recordDate:n.date,recordTime:n.time};f.get(`http://localhost:3000/patients/${D}`).then(s=>{const h=s.data;return h.recordHistory.push(o),f.put(`http://localhost:3000/patients/${D}`,h)}),f.get(`http://localhost:3000/doctors/${g}`).then(s=>{const h=s.data;return h.recordHistory.push(o),f.put(`http://localhost:3000/doctors/${g}`,h)}),f.get(`http://localhost:3000/personal/${C}`).then(s=>{const h=s.data;return h.recordHistory.push(o),f.put(`http://localhost:3000/personal/${C}`,h)})}else alert("На цей час вже є запис")},[z,L]=a.useState(""),[T,k]=a.useState(!1),ee=e=>{L(e.target.value),k(!!e.target.value)},te=()=>{k(!T)},ae=e=>{L(e.name),k(!1),r({...n,patientName:e.name}),q(e.id)},[xe,O]=a.useState(!1);a.useEffect(()=>{const e=new Date(n.date);O(e===new Date)},[n.date]);const[V,A]=a.useState(""),[U,P]=a.useState(!1),se=e=>{A(e.target.value),P(!!e.target.value)},oe=()=>{P(!U)},ne=e=>{A(e.name),P(!1),r({...n,doctorName:e.name}),G(e.id)},[F,H]=a.useState(""),[B,E]=a.useState(!1),re=e=>{H(e.target.value),E(!!e.target.value)},ce=()=>{E(!B)},de=e=>{H(e.name),E(!1),r({...n,personalName:e.name}),Q(e.id)};return t.jsx("div",{className:c["add-info__bg"],onClick:()=>_(!1),children:t.jsxs("div",{className:c["add-info__content"],onClick:e=>e.stopPropagation(),children:[u&&t.jsx(he,{setShowError:R}),t.jsxs("div",{className:c["add-info__form"],children:[t.jsx("div",{className:c["add-info__patient"],children:t.jsxs("div",{className:c["add-info__patient-name"],children:[t.jsx(j,{type:"text",id:"my-input",value:z,onChange:ee,onClick:te,placeholder:"Введіть ім'я пацієнта"}),T&&t.jsx("ul",{className:c["add-info__patient-list"],style:{zIndex:1e3},children:v.filter(e=>e.name.toLowerCase().includes(z.toLowerCase())).map(e=>t.jsxs("li",{onClick:()=>ae(e),children:[e.name," - ",e.id]},e.id))})]})}),t.jsxs("div",{className:c["add-info__patient"],children:[t.jsxs("div",{className:c["add-info__doctor-name"],children:[t.jsx(j,{type:"text",id:"my-input",value:V,onChange:se,onClick:oe,placeholder:"Введіть ім'я лікаря"}),U&&t.jsx("ul",{className:c["add-info__doctor-list"],style:{zIndex:1e3},children:S.filter(e=>e.name.toLowerCase().includes(V.toLowerCase())).map(e=>t.jsxs("li",{onClick:()=>ne(e),children:[e.name," - ",e.id]},e.id))})]}),t.jsxs("div",{className:c["add-info__doctor-name"],children:[t.jsx(j,{type:"text",id:"my-input",value:F,onChange:re,onClick:ce,placeholder:"Введіть ім'я мед. працівника"}),B&&t.jsx("ul",{className:c["add-info__doctor-list"],style:{zIndex:1e3},children:N.filter(e=>e.name.toLowerCase().includes(F.toLowerCase())).map(e=>t.jsxs("li",{onClick:()=>de(e),children:[e.name," - ",e.id]},e.id))})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-evenly"},children:[t.jsx("div",{style:{width:"40%"},children:t.jsx(j,{type:"date",min:new Date().toISOString().split("T")[0],onChange:e=>r({...n,date:e.target.value}),placeholder:"Оберіть дату"})}),t.jsx("div",{style:{width:"40%"},children:t.jsx(j,{type:"time",id:"appt",name:"appt",min:"08:00",max:"18:00",step:"3600",required:!0,placeholder:"Оберіть дату прийому",value:n.time||"",onChange:e=>{const s=e.target.value.replace(/:\d\d$/,":00");s>"18:00"||s<="07:00"?r({...n,time:""}):(e.target.value=s,r({...n,time:s}))},className:"my-input",onInput:e=>{const o=e.target.value;o<e.target.min?e.target.value=e.target.min:o>e.target.max&&(e.target.value=e.target.max),e.target.setCustomValidity("")}})})]})]})]}),t.jsx("button",{className:c["add-form__btn"],onClick:Z,children:m})]})})},me={},_e=({searchRecords:m,delateRecords:_,records:d})=>{const p=d.filter(l=>l.id.toString().includes(m));return t.jsx("div",{className:me["list-item"],children:p.reverse().map(l=>t.jsx(pe,{delateRecords:_,record:l},l.id))})},Ce=()=>{const[m,_]=a.useState(""),[d,p]=a.useState([]),[l,S]=a.useState(!0),{data:I,isLoading:v,error:$}=M("http://localhost:3000/records");a.useEffect(()=>{I&&(p(I),S(!1))},[I]);const N=r=>{_(r)},[w,x]=a.useState(!1),n=async r=>{f.delete(`http://localhost:3000/records/${r}`).then(u=>{console.log("Запис видалено",u)}).catch(u=>{console.error("Помилка при видалені запису",u)}),p(d.filter(u=>u.id!==r))};return t.jsx("div",{className:b.records,children:t.jsxs(ie,{children:[t.jsxs("div",{className:b["records-content"],children:[t.jsx(j,{value:m,onChange:r=>N(r.target.value),type:"number",maxLength:"50",placeholder:"Введіть ID запису"}),t.jsx("button",{className:b["records-btn"],onClick:()=>x(!0),children:"Додати запис"}),w&&t.jsx(fe,{addUser:"Додати запис",setShowForm:x,records:d,setRecords:p,api:"records"})]}),v||l?t.jsx(le,{}):t.jsx(_e,{searchRecords:m,delateRecords:n,records:d})]})})};export{Ce as default};
